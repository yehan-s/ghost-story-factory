# "AI 灵异地图" 开发管线架构 (V3.1) 🎯

**核心设计：** 选项交互式游戏 - 玩家从预设选项中选择，所有选择都在框架内运行

## 阶段 0: 原始素材 (Raw Material)
- [输入]: 互联网上收集的"荔湾广场"民间传说、故事细节。

    ⬇

## 阶段 1: 建立"地基" (The Foundation / Lore)
- [输入]: 阶段 0 的"原始素材"
- [执行]: **Prompt A: "世界书 1.0 生成器"** (lore-v1.prompt.md)
- [输出]: **《世界书 1.0 (高保真版)》**
- [目的]: 建立一个"客观的、高保真的"世界观 (Lore)。**它只回答 "Why" 和 "What"（为什么有诅咒？诅咒是什么？）。**

    ⬇

## 阶段 2: 并行派生 (Parallel Derivations)
- （《世界书 1.0》现在是所有后续工作的基础）

    ⬇

### 派生路径 A: "逻辑推导" (The Logic)
- [输入]: 《世界书 1.0》
- [执行]: **Prompt B: "主角线分析器"** (protagonist.prompt.md)
- [输出]: **《角色分析报告》**
- [目的]: **它回答 "Who"（谁是主角？）。**
- [结论]: 逻辑上推导出"保安"是唯一的主角线。

    ⬇

### 派生路径 B: "系统设计" (The Systems)
- [输入]: 《世界书 1.0》 + [专业评价]
- [执行]: **Prompt C: "世界书 2.0 升级器"** (lore-v2.prompt.md)
- [输出]: **《世界书 2.0 (系统增强版)》**
- [目的]: **它回答 "How"（这个世界怎么玩？）。**
- [结论]: 为"玩家"（即主角）构建了"共鸣度"、"后果树"等可玩系统。

    ⬇

## 阶段 3: 故事生成 (Story Generation)
- （《世界书 2.0》+ 《角色分析》融合为故事蓝图）

    ⬇

### 派生路径 C: "AI 导演设计" (The Director)
- [输入]: 《世界书 2.0》+ 《角色分析》
- [执行]: **Prompt D: "AI 导演任务简报生成器"** (GDD.prompt.md)
- [输出]: **《AI 导演任务简报》**（针对保安线）
- [目的]: **它回答 "How to Play"（如何将规则转化为可玩的剧情流程？）。**
- [结论]: 定义了关键场景、共鸣度追踪、后果树分支点等 AI 导演的执行规范。

    ⬇

### 派生路径 D: "主线故事执行" (The Main Thread)
- [输入]: 《AI 导演任务简报》+ 《世界书 2.0》
- [执行]: **Prompt E: "主线故事生成器"** (main-thread.prompt.md)
- [输出]: **《主线故事范文》**（保安线完整故事）
- [目的]: **它回答 "Show, Don't Tell"（如何用沉浸式文笔演绎主线？）。**
- [结论]: 产出 UP 主风格的长篇故事文案（≥1800 字，多感官细节，第二人称代入）。

    ⬇

### 派生路径 E: "支线故事并行" (The Side Branches)
- [输入]: 《世界书 2.0》+《主线故事》（关联点）
- [执行]: **Prompt F/G: "支线故事生成器"** (branch-1.prompt.md / branch-2.prompt.md)
- [输出]:
  - **《支线故事：店主线》** (branch-1.example.md)
  - **《支线故事：顾客线》** (branch-2.example.md)
- [目的]: **它回答 "Interconnected World"（如何让世界感觉'活'了起来？）。**
- [结论]: 支线与主线在同一时空发生，通过"关联点"（如 4:44 事件）形成呼应。

    ⬇

## 阶段 4: 交互运行层 (Runtime Interaction)
-（阶段1-3产出"静态内容"，阶段4让世界"动起来"——实时响应玩家输入）

    ⬇

### 派生路径 F: "实时响应生成" (Runtime Response)
- [输入]: 玩家自由文本输入 + 当前游戏状态
- [执行]: **Prompt H: "实时响应生成器"** (runtime-response.prompt.md)
- [输出]: **单次交互的AI响应**（200-500字，分层结构）
- [目的]: **它回答 "How to React"（如何在每次玩家输入后生成恰当的响应？）。**
- [结论]: 将玩家行为转化为沉浸式叙事响应，包含物理反馈、感官细节、心理暗示、引导提示四层。

    ⬇

### 派生路径 G: "意图识别与映射" (Intent Mapping)
- [输入]: 玩家自由文本 + 游戏上下文
- [执行]: **Prompt I: "意图识别引擎"** (intent-mapping.prompt.md)
- [输出]: **标准化意图分类**（EXPLORE/INTERACT/DEFEND/WAIT + 子类别）
- [目的]: **它回答 "What Does Player Mean"（玩家想做什么？）。**
- [结论]: 将千变万化的自然语言（"我躲起来"/"我藏在桌子下"/"我装死"）映射到统一的游戏意图，并绑定到《GDD》的后果树分支。

    ⬇

### 派生路径 H: "状态管理" (State Management)
- [输入]: 当前游戏状态 + 状态更新请求
- [执行]: **Prompt J: "状态管理器"** (state-management.prompt.md)
- [输出]: **验证并更新后的游戏状态**（玩家/世界/叙事/元数据四层）
- [目的]: **它回答 "How to Remember"（如何维护世界的记忆和规则？）。**
- [结论]: 管理共鸣度、实体等级、时间、道具、旗标等所有状态，确保100%符合《世界书 2.0》规则，支持快照、回滚、验证。

---

## 完整数据流（从素材到运行时）

```
原始素材 (互联网传说)
    ↓
[阶段1] 世界书 1.0 (高保真地基)
    ↓
    ├─→ [阶段2A] 角色分析 (Who)
    └─→ [阶段2B] 世界书 2.0 (How)
            ↓
            ├─→ [阶段3C] AI 导演简报 (How to Play)
            ├─→ [阶段3D] 主线故事 (Show, Don't Tell)
            └─→ [阶段3E] 支线故事 (Interconnected World)
                    ↓
            [阶段4: 运行时循环 - 选项交互式]
                    ┌─────────────────┐
                    │ 剧情推进         │
                    └────────┬────────┘
                             ↓
                    ┌─────────────────┐
                    │ Choice Points    │ 🎯 核心：生成选项
                    │ 微选择/普通/关键 │
                    └────────┬────────┘
                             ↓
                    ┌─────────────────┐
                    │ 玩家选择 A/B/C/D │
                    └────────┬────────┘
                             ↓
                    ┌─────────────────┐
                    │ State Check      │ 验证前置条件
                    └────────┬────────┘
                             ↓
                    ┌─────────────────┐
                    │ Runtime Response │ 生成响应
                    │ (基于玩家选择)   │
                    └────────┬────────┘
                             ↓
                    ┌─────────────────┐
                    │ State Update     │ 应用后果
                    │ +级联更新        │
                    └────────┬────────┘
                             ↓
                    ┌─────────────────┐
                    │ GDD/Lore Check   │ 检查分支/事件
                    └────────┬────────┘
                             ↓
                    ┌─────────────────┐
                    │ 剧情继续         │
                    └────────┬────────┘
                             ↓
                    [循环：下一个选择点]

---

## 关键设计理念

**选项交互式 vs 自由输入式：**
- ❌ 自由输入：玩家输入任何文本 → Intent Mapping → 响应
  - 优点：自由度高
  - 缺点：难以控制，容易跳出框架

- ✅ 选项交互：Choice Points生成2-4个选项 → 玩家选择 → 响应
  - 优点：可控、可预测、剧情稳定
  - 缺点：自由度受限（但通过"结构化自由"设计弥补）

**Intent Mapping 的新角色：**
- 在选项式游戏中，Intent Mapping 不再处理"自由文本"
- 而是用于：
  1. 辅助 Choice Points 生成合理的选项
  2. 将玩家的选择（A/B/C/D）映射到后果树
  3. 处理极少数的"自由文本补充"（如输入NPC名字）
```