# Runtime Response Generator - 设计说明 (Design Rationale)

**文档用途：** 本说明阐明"实时响应生成器"的核心设计原则。它解释了如何在选项交互式游戏中，针对玩家的每一次选择，生成恰当的、沉浸式的、推进剧情的响应。

---

## 游戏交互模式说明

**本项目采用：选项交互式**
- 玩家从预设的2-4个选项中选择（A/B/C/D）
- Choice Points 模块负责生成选项
- Runtime Response 基于玩家的选择生成响应
- 优点：可控、可预测、剧情稳定，玩家不会跳出框架

**注：** 本文档也兼容"自由输入式"（酒馆式），但主要设计目标是支持选项式交互。

---

## 核心原则一：单次交互的原子性 (Atomic Interaction)

**设计说明：** 交互式游戏不是"一次性生成完整故事"，而是"玩家选择 → AI响应"的循环。

**实现方式：**
- 每次响应是**独立的原子单元**（200-500字）
- 每次响应必须包含三个要素：
  1. **对玩家选择的确认** - "你选择躲进监控室..."
  2. **世界的反馈** - "门轴发出刺耳的吱呀声，土腥味扑面而来..."
  3. **下一步的选项引导** - "监控屏幕在闪烁...（等待下一个选择点）"

**目的：** 让玩家清楚知道"我的选择生效了"，同时保持悬念，引导进入下一个选择点。

---

## 核心原则二：状态驱动叙事 (State-Driven Narrative)

**设计说明：** 响应的内容不是随机的，而是**严格基于当前游戏状态**生成的。

**实现方式：**
- 每次响应前，AI 必须**读取**并**更新**游戏状态：
  ```json
  {
    "location": "五楼中庭",
    "resonance": 45,
    "time": "03:45 AM",
    "entities": {"清洁工": {"level": 1, "location": "五楼"}},
    "flags": {"场景3_电梯失控": true}
  }
  ```
- 响应内容必须**反映**状态变化：
  - 共鸣度 30% → 50%：AI 必须加入"你的后颈开始发凉"等生理反馈
  - 时间 04:43 → 04:44：AI 必须触发特殊事件
  - 实体等级 1 → 2：AI 必须改变实体的行为描述

**目的：** 确保游戏世界的"因果一致性"，玩家的每个行为都会产生可预测的后果。

---

## 核心原则三：分层响应结构 (Layered Response Structure)

**设计说明：** 每次响应不是"平铺直叙"，而是**分层嵌套**的信息结构。

**实现方式：**
- **第一层（物理层）** - 即时的物理反馈（200字）
  - 玩家输入："我推开门"
  - AI 响应："门轴发出刺耳的吱呀声，你的手感受到冰冷的门把手..."

- **第二层（感官层）** - 环境的多感官细节（150字）
  - "土腥味扑面而来，混杂着潮湿的霉味..."
  - "[音效: 远处传来滴水声，嘀嗒...嘀嗒...]"

- **第三层（心理层）** - 共鸣度的心理暗示（100字）
  - "你的汗毛竖了起来，一种被注视的感觉..." （共鸣度上升）
  - "佛经声似乎让那股压迫感减轻了..." （共鸣度下降）

- **第四层（引导层）** - 软引导下一步（50字）
  - "监控屏幕在黑暗中闪烁，五楼的画面似乎有什么不对劲..."

**目的：**
1. 保持沉浸感（多感官细节）
2. 传递系统信息（共鸣度变化）
3. 引导探索（暗示可行动的对象）

---

## 核心原则四：软硬引导平衡 (Soft-Hard Guidance Balance)

**设计说明：** AI 既要尊重玩家的自由探索，又要防止玩家"卡关"或"跑题"。

**实现方式：**

**情况 A：自由探索期（场景1-2）**
- 使用**软引导**（环境暗示）
  ```
  AI: "四楼的走廊很安静，但你注意到那家玉器店的卷帘门缝隙里，
  似乎还透着微弱的灯光..."
  [玩家可以选择：调查玉器店 / 继续巡逻 / 去五楼]
  ```

**情况 B：关键节点（场景4-5）**
- 使用**硬引导**（明确选项）
  ```
  AI: "失魂者已经走到了围栏边缘，他的脚尖悬在半空。你必须做出选择：
  A) 冲过去拉住他
  B) 大声呼喊唤醒他
  C) 打开念佛机
  D) 保持距离观察
  （请在30秒内输入你的选择）"
  ```

**情况 C：玩家跑题**
- 使用**剧情锚点**拉回
  ```
  玩家输入: "我想离开商场"
  AI: "你冲向一楼的玻璃门，用力推...门纹丝不动。
  门把手上贴着一张泛黄的纸条：'下班时间已过，请明早10点再来。'
  你的手机还是没有信号。
  [系统: 这是'困兽之局'，你必须面对这栋楼的秘密]"
  ```

**目的：** 在"自由度"和"剧情推进"之间找到平衡。

---

## 核心原则五：失败也是内容 (Failure as Content)

**设计说明：** 玩家的"错误选择"不应导致"Game Over"，而应产生**新的剧情分支**。

**实现方式：**

**传统设计（❌）：**
```
玩家: "我冲过去抓住失魂者"
AI: "你触碰到了他，瞬间失去意识。Game Over。"
```

**本设计（✅）：**
```
玩家: "我冲过去抓住失魂者"
AI: "你的手穿过他的身体——他不是活人。
冰冷的触感瞬间传遍全身，你的共鸣度暴涨至80%。
[系统: 触发 '失衡' 分支]
失魂者猛地转头，那张脸...没有五官，只有一个黑洞般的嘴。
他发出尖锐的哭喊，整栋楼的灯光开始闪烁。
五楼的所有玻璃窗同时炸裂！
[场景转变: 你被迫进入 '高危模式'，必须在5分钟内找到念佛机]"
```

**目的：** "没有失败，只有分支" - 让玩家的每个选择都有意义。

---

## 核心原则六：氛围连续性 (Atmospheric Continuity)

**设计说明：** 即使在"玩家等待/思考"的间隙，游戏世界也在"呼吸"。

**实现方式：**
- **环境循环描述**（每30秒触发一次）
  ```
  [玩家沉默超过30秒]
  AI: "荧光灯又闪了一下，'嗡——'的电流声在空旷的走廊里回荡。
  你的手表显示：04:42 AM。"
  ```

- **实体巡逻提示**
  ```
  [玩家在场景3停留过久]
  AI: "对讲机突然爆出一阵电流声：'滋——保安？保安？'
  那是...张叔的声音？但他不是已经下班了吗？
  声音很快被淹没在刺耳的杂音中。"
  ```

**目的：** 制造"时间压力"，防止玩家"挂机"，保持紧张感。

---

## 数据结构定义

### 输入结构
```json
{
  "player_input": "我推开监控室的门",
  "game_state": {
    "location": "五楼走廊",
    "resonance": 40,
    "time": "03:45 AM",
    "inventory": ["手电筒", "对讲机"],
    "entities": {"清洁工": {"level": 1, "location": "B3"}},
    "flags": {"场景2_巡逻_已完成": true}
  }
}
```

### 输出结构
```json
{
  "response_text": "门轴发出刺耳的吱呀声...",
  "state_updates": {
    "location": "监控室",
    "resonance": 45,
    "flags": {"监控室_已进入": true}
  },
  "triggered_events": ["场景3_电梯失控"],
  "next_hints": ["检查监控屏幕", "查看巡更记录"]
}
```

---

## 质量标尺

| 维度 | 低质量 | 高质量 |
|------|--------|--------|
| **长度** | <100字或>800字 | 200-500字 |
| **确认** | 忽略玩家输入 | 明确反馈玩家行为 |
| **感官** | 只有视觉描述 | 3种以上感官（视/听/嗅/触/心理） |
| **状态** | 不更新共鸣度 | 每次交互都反映状态变化 |
| **引导** | 无下一步提示 | 至少1个软引导暗示 |
| **氛围** | 破坏既定风格 | 保持《世界书》的土腥味/潮湿/冰冷基调 |

---

## 与其他模块的关系

```
┌─────────────────┐
│ 玩家自由输入     │ "我推开门"
└────────┬────────┘
         ↓
┌─────────────────┐
│ Intent Mapping   │ 识别意图: "探索 → 监控室"
└────────┬────────┘
         ↓
┌─────────────────┐
│ State Management │ 读取当前状态 (location/resonance/flags)
└────────┬────────┘
         ↓
┌─────────────────┐
│ Runtime Response │ 生成分层响应 (物理/感官/心理/引导)
└────────┬────────┘
         ↓
┌─────────────────┐
│ State Update     │ 更新状态 (location="监控室", resonance=45)
└────────┬────────┘
         ↓
┌─────────────────┐
│ GDD Check        │ 检查是否触发场景事件 (场景3)
└─────────────────┘
```

---

## 设计哲学来源

- **酒馆式游戏** (AI Dungeon) - 自由文本输入的响应式叙事
- **《世界书 2.0》** - 共鸣度系统的实时追踪
- **《AI 导演简报》** - 场景化流程的节点触发
- **《主线templates》** - 沉浸式文笔的氛围标准

---

**核心理念：** Runtime Response 是"规则"与"文笔"的桥梁。它让《世界书》的冰冷数字（共鸣度45%）变成玩家能感受到的"汗毛竖起"，让《GDD》的抽象流程（场景3）变成玩家能体验的"电梯失控"。

