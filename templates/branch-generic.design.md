# 通用支线 AI 导演任务简报设计原则

## 设计理念

支线不是"额外内容"，而是基于**角色分析白名单**的**多视角叙事系统**。每条支线都必须：
1. 基于角色分析报告中评估的具体角色
2. 遵循该角色的访问权、交集点、动机评估
3. 与主线产生有意义的关联
4. 提供独立完整的故事体验

## 核心架构

### 1. 角色驱动（Role-Driven）

**原则：** 支线角色来自角色分析白名单，而非创意臆造。

**流程：**
```
角色分析报告
  ├─ 主角线（1个）：访问权高 + 交集点完整 + 动机主动
  └─ 支线候选（N个）：
      ├─ 惊悚体验支线：访问权低 + 动机被动（如：登山女跑者）
      ├─ 舆论/资料支线：访问权弱 + 动机主动（如：主播、豆瓣组长）
      ├─ 证据支线：访问权部分 + 交集单一（如：录音博主）
      └─ 对抗阻力：访问权高 + 动机掩盖（如：值班经理）
```

**实现：**
- 系统自动解析角色分析报告
- 提取除主角外的所有评估角色
- 识别角色的支线类型标签
- 为每个角色生成独立的支线GDD和故事

### 2. 访问权约束（Agency Constraint）

**原则：** 角色只能访问其在角色分析中被判定为"合法"的地点。

**示例：**

| 角色 | 访问权评估 | 支线场景限制 |
|------|-----------|------------|
| 夜班保安 | 观景台（部分受限）、值班室（权限受限） | 只能在巡逻路线和值班室活动 |
| 登山女跑者 | 公共步道（擅闯）、其他地点（无法访问） | 只能在山道活动，无法进入建筑内部 |
| 特检院工程师 | 所有地点（全部合法） | **主角线**，不做支线 |

**规则：**
- 如果角色分析判定"无进入理由"→ 支线GDD不得设计进入该地点的场景
- 如果角色分析判定"需额外审批"→ 支线GDD可设计尝试但被拒的剧情
- 如果角色分析判定"合法访问"→ 支线GDD可自由设计该地点的场景

### 3. 交集点利用（Intersection Point）

**原则：** 支线必须聚焦于该角色在角色分析中被识别的"交集点"。

**示例：**

| 角色 | 交集点评估 | 支线场景设计 |
|------|-----------|------------|
| 录音博主 | 65Hz声纹（可精准捕获） | 场景1：携带ZOOM H1录到竖线<br>场景2：分析声纹图谱发现异常 |
| 主播 | 第三节灯闪（触发概率高）+ 监控盲区（直播事故） | 场景1：红外相机拍到灯闪<br>场景2：直播监控画面却永远静止 |
| 避雷针维护工 | 0.8Hz共振（可测量） | 场景1：检修时发现异常共振<br>场景2：测量数据超出正常范围 |

**规则：**
- 不得让角色与其"交集点评估"中标注为"无感知"的现象产生互动
- 必须充分利用角色的专业设备或身份特权
- 交集点不完整的角色，故事重点放在"局部真相"而非"全景调查"

### 4. 动机一致性（Motivation Consistency）

**原则：** 角色的支线行为必须符合其在角色分析中判定的动机类型。

**动机类型对照表：**

| 动机类型 | 角色示例 | 支线剧情重心 | 后果树设计 |
|---------|---------|------------|-----------|
| **被动逃跑** | 登山女跑者、夜班保安 | 恐怖氛围、惊悚体验、求生逃离 | [A: 成功逃离] vs [B: 被困/同化] |
| **主动调查** | 主播、录音博主、豆瓣组长 | 证据收集、真相探寻、信息整合 | [A: 获得证据但失去平台] vs [B: 撤退保全] |
| **被动掩盖** | 值班经理 | 阻力制造、与主角对抗 | [A: 掩盖失败] vs [B: 牺牲他人保住职位] |

**规则：**
- 被动逃跑型：不得设计"主动深入调查"的场景，只能设计"被迫卷入 → 惊慌逃离"
- 主动调查型：可设计"发现线索 → 深入取证 → 面临抉择"
- 被动掩盖型：可设计"阻止主角 → 销毁证据 → 最终败露"

### 5. 主线关联点（Mainline Association）

**原则：** 每条支线必须有至少一个场景与主线产生联系，但联系方式必须符合该角色的能力。

**关联方式设计表：**

| 角色能力 | 关联方式 | 场景示例 |
|---------|---------|---------|
| 有监控访问权 | **实时目击** | 通过监控画面看到主角在五楼的对峙 |
| 在公共区域 | **间接感知** | 听到爆裂声、震动、广播异常 |
| 有专业设备 | **数据异常** | 测量仪器记录到同步的能量峰值 |
| 与主线实体接触 | **威胁转移** | 主线的灵异实体在事件后转向支线角色 |

**时间同步示例：**
```
主线时间轴：
  04:44 - 主角在五楼与"清洁工"对峙

支线1（店主线）同步点：
  04:44 - 通过监控画面实时目击五楼事件
  04:50 - "清洁工"察觉窥视，转而入侵四楼

支线2（顾客线）同步点：
  00:50 - 在B3遇到"白衣女子"
  白衣女子的警告："'饲养员'被激怒了，他在'上面'追那个'破坏者'！"
  （对应主线的04:44事件，时空错位的预警）
```

**余波设计（Backlash）：**
- 主线事件打破平衡 → 灵异实体扩散到支线场景
- 主线角色的行动 → 支线角色的环境突变
- 主线的"仪式被打断" → 支线感受到"场域不稳定"

## 支线类型定位

### 类型1: 惊悚体验支线

**特征：**
- 访问权低、动机被动
- 重心：第一人称恐怖体验、无力感、逃生张力

**典型角色：** 登山女跑者、夜班保安、被困顾客

**场景设计：**
1. 被困/被卷入（无法脱身）
2. 异象升级（恐怖氛围营造）
3. 主线关联（间接感知主线危机）
4. 千钧一发的逃离

**结局方向：**
- 结局A：幸存，但心理创伤 + 手机时间异常
- 结局B：未能逃脱，同化为灵异实体的一部分

### 类型2: 舆论/资料支线

**特征：**
- 访问权弱、动机主动（线上为主）
- 重心：信息整合、网络舆论、时间线梳理

**典型角色：** 城市传说主播、豆瓣灵异小组长

**场景设计：**
1. 搜集网友碎片信息
2. 整理出事件时间线
3. 尝试现场验证（受访问权限制，受阻）
4. 发布内容后遭遇"网络怪谈成真"

**结局方向：**
- 结局A：帖子火爆但被删除，账号封禁
- 结局B：发现真相但不敢发布，自我审查

### 类型3: 证据支线

**特征：**
- 访问权部分、交集单一、动机主动
- 重心：专业设备、物证获取、科学记录

**典型角色：** 录音设备测评博主、避雷针维护工

**场景设计：**
1. 使用专业设备记录异常
2. 发现数据超出常理
3. 尝试解释（科学 vs 超自然）
4. 证据的代价（设备损坏 / 数据消失）

**结局方向：**
- 结局A：保留证据，但无人相信
- 结局B：证据被销毁，但自己确信真相

### 类型4: 对抗阻力

**特征：**
- 访问权高、动机掩盖、与主角对立
- 重心：权力压制、证据销毁、最终败露

**典型角色：** 索道值班经理、物业主管

**场景设计：**
1. 发现异常但选择隐瞒
2. 阻止主角的调查行动
3. 销毁关键证据
4. 掩盖失败（主角找到其他证据 / 灵异实体失控）

**结局方向：**
- 结局A：掩盖失败，职业生涯终结
- 结局B：牺牲他人（如清洁工）来保住自己

## 技术实现要点

### 1. 自动解析角色分析

**目标：** 从角色分析报告中提取：
- 主角名称（用于排除）
- 支线角色列表（所有非主角的评估角色）
- 每个角色的支线类型标签（如："惊悚体验支线"）

**解析模式：**
```python
# 查找主角
main_role = re.search(r'最终建议.*?[:：]\s*(.+)', protagonist)

# 查找支线角色分类
# 模式：- 夜班保安、登山女跑者 → **惊悚体验支线**
branch_lines = re.findall(
    r'[-–]\s*([^→]+?)\s*[→->]\s*\*\*([^*]+?支线)\*\*',
    protagonist
)

# 如果没有明确分类，则查找所有评估的角色
all_roles = re.findall(r'###\s*\d+\.\s*([^\n]+)', protagonist)
```

### 2. 动态生成文件名

**规则：**
- 使用角色名而非编号：`{城市}_branch_{idx}_{角色名}_gdd.md`
- 角色名需要sanitize：去除特殊字符，保留中英文和数字

**示例：**
```
杭州_branch_1_夜班保安_gdd.md
杭州_branch_1_夜班保安_story.md
杭州_branch_2_登山女跑者_gdd.md
杭州_branch_2_登山女跑者_story.md
```

### 3. 支线数量灵活化

**原则：** 不固定生成2条支线，而是根据角色分析中的支线候选数量动态生成。

**处理：**
- 如果角色分析中有5个支线候选 → 生成5条支线
- 如果角色分析中只有2个支线候选 → 生成2条支线
- 如果角色分析中未明确支线分类 → 尝试提取所有评估角色（排除主角）

### 4. README 动态更新

**原则：** README 的支线部分应该反映实际生成的支线数量和角色名。

**生成逻辑：**
```python
for idx, role_info in enumerate(branch_roles, start=1):
    role_name = role_info['name']
    branch_type = role_info['type']
    readme_lines.append(
        f"- 支线{idx}: {role_name}（{branch_type}）"
    )
```

## 常见问题

### Q: 如果角色分析没有明确的支线分类怎么办？

A: 系统会fallback到提取所有评估的角色（排除主角），并将它们标记为"支线"类型。虽然不如明确分类精准，但至少能确保支线基于角色分析白名单。

### Q: 如果某个角色的访问权太低，无法设计有效场景怎么办？

A: 这正是角色分析的价值所在。如果角色分析判定某角色"访问权极弱 + 交集极窄 + 动机被动"，那么这个角色可能本身就不适合做支线。可以在支线生成时跳过，或者将其作为"纯受害者"的极短篇。

### Q: 支线可以比主线更长吗？

A: 不建议。支线的定位是"补充视角"，通常应短于主线（1500-2000字 vs 主线的3000-5000字）。如果某个支线角色的故事潜力很大，应该考虑调整角色分析，将其作为主角。

## 总结

**支线设计的黄金法则：**
1. 🎭 **基于角色分析白名单** - 不臆造角色
2. 🔒 **遵循访问权约束** - 不跨越角色能力
3. 🎯 **利用交集点** - 不设计无关场景
4. 💡 **符合动机类型** - 不违背角色性格
5. 🔗 **与主线关联** - 不独立成孤岛
6. ⭐ **独立完整** - 不依赖主线才能理解

当所有支线都遵循这些原则时，整个故事宇宙将呈现出：
- **多视角的立体感**（从不同角色看同一事件）
- **世界观的自洽性**（所有故事共享同一套规则）
- **游戏化的可能性**（每条支线都可作为独立游戏关卡）

---

**设计版本**: v1.0
**更新日期**: 2025-10-24

